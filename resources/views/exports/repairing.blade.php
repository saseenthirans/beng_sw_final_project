<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Repairing Export</title>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th colspan="11" style="text-transform: uppercase; font-size: 20px; text-align: center">
                    RK MOBILES
                </th>
            </tr>
            <tr>
                <th colspan="11" style="text-transform: uppercase; font-size: 16px; text-align: left">
                    Repairing Summery Report
                </th>
            </tr>
            <tr></tr>
            <tr>
                <th colspan="5">
                    @if ($category != '')
                        Category : {{$category}}
                    @endif
                </th>
                <th colspan="3">
                    @if (isset($request->start_date) && !empty($request->start_date))
                        From : {{date('M, d Y', strtotime($request->start_date))}}
                    @endif
                </th>
                <th colspan="3">
                    @if (isset($request->end_date) && !empty($request->end_date))
                        To : {{date('M, d Y', strtotime($request->end_date))}}
                    @endif
                </th>

            </tr>

            <tr></tr>
            <tr>
                <th colspan="11" style="text-transform: uppercase; text-align: right">
                    Generated By : {{Auth::user()->name}}
                </th>
            </tr>
            <tr>
                <th colspan="11" style="text-transform: uppercase; text-align: right">
                    Generated At : {{date('M, d Y h:i A')}}
                </th>
            </tr>

            <tr></tr>

            <tr>
                <th style="font-weight: 600; text-align: center">#</th>
                <th style="font-weight: 600; text-align: center">Ref. No</th>
                <th style="font-weight: 600; text-align: center">Taken Date</th>
                <th style="font-weight: 600; text-align: center">Customer Name</th>
                <th style="font-weight: 600; text-align: center">Created By</th>
                <th style="font-weight: 600; text-align: center">Amount</th>
                <th style="font-weight: 600; text-align: center">Advanced Amount</th>
                <th style="font-weight: 600; text-align: center">Balance Amount</th>
                <th style="font-weight: 600; text-align: center">Status</th>
                <th style="font-weight: 600; text-align: center">Paid Status</th>
                <th style="font-weight: 600; text-align: center">Collected At</th>
            </tr>
        </thead>
        <tbody>
            @if (count($repairing))
                @php
                    $i = 0;
                    $sub_total = 0;
                    $paidamount = 0;
                    $due_amount = 0;
                @endphp
                @foreach ($repairing as $item)
                    @php
                        $i++;

                         //Pay Status
                        if ($item->paid_status == 0) {
                            $pay_color = 'red';
                            $pay_status = 'Not Paid';
                        }

                        if ($item->paid_status == 1) {
                            $pay_color = 'yellow';
                            $pay_status = 'Advance Paid';
                        }

                        if ($item->paid_status == 2) {
                            $pay_color = 'green';
                            $pay_status = 'Fully Paid';
                        }

                        //item Status
                        if ($item->status == 0) {
                            $status_color = 'red';
                            $status = 'Taken';
                        }

                        if ($item->status == 1) {
                            $status_color = 'yellow';
                            $status = 'Processing';
                        }

                        if ($item->status == 2) {
                            $status_color = 'blue';
                            $status = 'Ready to Collect';
                        }

                        if ($item->status == 3) {
                            $status_color = 'green';
                            $status = 'Collected';
                        }
                    @endphp

                    <tr>
                        <td>{{$i}}</td>
                        <td>{{$item->ref_no}}</td>
                        <td>{{$item->taken_date}}</td>
                        <td>{{$item->customer->name}}</td>
                        <td>{{$item->creator->name}}</td>
                        <td>{{number_format($item->amount,2,'.','')}}</td>
                        <td>{{number_format($item->adv_amount,2,'.','')}}</td>
                        <td>{{number_format($item->amount - $item->adv_amount,2,'.','')}}</td>
                        <td>{{$status}}</td>
                        <td>{{$pay_status}}</td>
                        <td>{{$item->collected_at}}</td>
                    </tr>
                    @php
                        $sub_total = $sub_total + $item->amount;
                        $paidamount = $paidamount + $item->adv_amount;
                        $due_amount = number_format($due_amount + ($item->amount - $item->adv_amount),2,'.','');
                    @endphp
                @endforeach
                <tr>
                    <td colspan="5"></td>
                    <td style="font-weight: 600;text-align: right">{{number_format($sub_total, 2)}}</td>
                    <td style="font-weight: 600;text-align: right">{{number_format($paidamount, 2)}}</td>
                    <td style="font-weight: 600;text-align: right">{{number_format($due_amount, 2)}}</td>
                    <td colspan="3"></td>
                </tr>
            @else
                <tr>
                    <th colspan="11" style="text-transform: uppercase; font-size: 14px; text-align: center">
                        No Data Found!
                    </th>
                </tr>
            @endif

        </tbody>
    </table>
</body>
</html>
